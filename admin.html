<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin • Upload Verdict CSV</title>
<meta name="theme-color" content="#0b0f14" />

<style>
:root{
  color-scheme:dark;
  --bg:#0b0f14;
  --text:#e6edf3;
  --muted:#9fb0c3;
  --line:rgba(255,255,255,.08);
  --ok:#2fe67a;
  --warn:#ffd24a;
  --bad:#ff5c7a;
  --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  color:var(--text);
  padding:24px;
}
.wrap{max-width:1000px;margin:auto}
header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:16px
}
h1{margin:0;font-size:20px}
.sub{color:var(--muted);font-size:13px}
.btn{
  border:1px solid var(--line);
  background:rgba(255,255,255,.05);
  color:var(--text);
  padding:9px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:900;
  font-size:13px
}
.btn:hover{background:rgba(255,255,255,.08)}
.btn.ok{border-color:rgba(47,230,122,.35)}
.btn.danger{border-color:rgba(255,92,122,.35)}

.panel{
  border:1px solid var(--line);
  border-radius:16px;
  background:rgba(255,255,255,.02);
  box-shadow:var(--shadow);
  margin-bottom:14px;
  overflow:hidden
}
.panel .hd{
  padding:12px 14px;
  border-bottom:1px solid var(--line);
  font-weight:950;
}
.panel .bd{padding:14px}

textarea{
  width:100%;
  min-height:260px;
  border:1px solid var(--line);
  background:rgba(0,0,0,.25);
  color:var(--text);
  border-radius:14px;
  padding:12px;
  font-family:monospace;
  font-size:12px;
  resize:vertical
}

.kv{
  display:grid;
  grid-template-columns:200px 1fr;
  gap:6px 12px;
  font-size:13px
}
.k{color:var(--muted);font-weight:800}
.v{font-weight:900}

.empty{
  text-align:center;
  padding:24px;
  color:var(--muted);
  font-weight:900
}
</style>
</head>

<body>
<div class="wrap">

<header>
  <div>
    <h1>Admin • Verdict CSV</h1>
    <div class="sub">
      Paste CSV below and click Save.  
      Index reads from <b>localStorage.VERDICT_CSV</b>
    </div>
  </div>

  <div style="display:flex;gap:10px;flex-wrap:wrap">
    <button class="btn" id="btnSample">Load Sample</button>
    <button class="btn ok" id="btnSave">Save</button>
    <button class="btn" id="btnPreview">Preview</button>
    <button class="btn danger" id="btnClear">Clear</button>
  </div>
</header>

<section class="panel">
  <div class="hd">Paste CSV</div>
  <div class="bd">
    <textarea id="csvBox" placeholder="Paste CSV here..."></textarea>
    <div class="sub" style="margin-top:8px">
Required columns:
record_id,date,ltp,capital_inr,market,instrument,mode,verdict,confidence_score_percent,entry_zone,invalid_if_above,risk_per_trade_inr,daily_loss_cap_inr
    </div>
  </div>
</section>

<section class="panel">
  <div class="hd">Saved Status</div>
  <div class="bd">
    <div class="kv">
      <div class="k">Saved rows</div><div class="v" id="savedRows">—</div>
      <div class="k">Last saved</div><div class="v" id="savedAt">—</div>
    </div>
    <div id="previewOut" style="margin-top:14px"></div>
  </div>
</section>

</div>

<script>
const LS_CSV_KEY="VERDICT_CSV";
const LS_CSV_TS="VERDICT_CSV_TS";

const REQUIRED=[
"record_id","date","ltp","capital_inr","market","instrument","mode","verdict",
"confidence_score_percent","entry_zone","invalid_if_above","risk_per_trade_inr","daily_loss_cap_inr"
];

const SAMPLE=`record_id,date,ltp,capital_inr,market,instrument,mode,verdict,confidence_score_percent,entry_zone,invalid_if_above,risk_per_trade_inr,daily_loss_cap_inr
MCXGOLD-20260220-V1,2026-02-20,154700,35000,MCX,Gold Futures (02APR2026),Intraday,SELL,68,"Below 154600 breakdown","155200",350,700
MCXSILVER-20260220-V1,2026-02-20,182450,35000,MCX,Silver Futures (05MAR2026),Intraday,SELL,64,"Below 182000 breakdown","183200",350,700
MCXCRUDE-20260220-V1,2026-02-20,6280,35000,MCX,Crude Oil Futures (19MAR2026),Intraday,BUY,72,"Above 6240 breakout","6180",350,700
MCXZINC-20260220-V1,2026-02-20,267.5,35000,MCX,Zinc Futures (28MAR2026),Intraday,SELL,61,"Below 266 breakdown","270",350,700
MCXCOPPER-20260220-V1,2026-02-20,748.3,35000,MCX,Copper Futures (29MAR2026),Intraday,BUY,66,"Above 744 breakout","738",350,700`;

function parseCSV(text){
const rows=text.trim().split("\n").map(r=>r.split(","));
const header=rows.shift().map(h=>h.trim());
return {header,rows};
}

function validate(text){
if(!text||text.trim().length<10)return{ok:false,msg:"CSV empty"};
const {header,rows}=parseCSV(text);
const missing=REQUIRED.filter(c=>!header.includes(c));
if(missing.length)return{ok:false,msg:"Missing: "+missing.join(", ")};
if(!rows.length)return{ok:false,msg:"No data rows"};
return{ok:true,msg:"Valid CSV • "+rows.length+" rows"};
}

function readSaved(){
const raw=localStorage.getItem(LS_CSV_KEY);
const ts=localStorage.getItem(LS_CSV_TS);
document.getElementById("savedRows").textContent=raw?(raw.match(/\n/g)||[]).length:"0";
if(ts){
const d=new Date(Number(ts));
document.getElementById("savedAt").textContent=d.toLocaleString();
}else{
document.getElementById("savedAt").textContent="—";
}
return raw;
}

document.getElementById("btnSample").onclick=()=>{
document.getElementById("csvBox").value=SAMPLE;
};

document.getElementById("btnPreview").onclick=()=>{
const res=validate(document.getElementById("csvBox").value);
document.getElementById("previewOut").innerHTML=res.ok
?'<div style="color:var(--ok)">'+res.msg+'</div>'
:'<div style="color:var(--bad)">'+res.msg+'</div>';
};

document.getElementById("btnSave").onclick=()=>{
const text=document.getElementById("csvBox").value.trim();
const res=validate(text);
if(!res.ok){
alert(res.msg);
return;
}
localStorage.setItem(LS_CSV_KEY,text+"\n");
localStorage.setItem(LS_CSV_TS,String(Date.now()));
readSaved();
alert("Saved successfully");
};

document.getElementById("btnClear").onclick=()=>{
localStorage.removeItem(LS_CSV_KEY);
localStorage.removeItem(LS_CSV_TS);
readSaved();
document.getElementById("previewOut").innerHTML="";
};

readSaved();
</script>

</body>
</html>
