<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Commodity Verdict</title>
<meta name="theme-color" content="#0b0f14" />

<style>
:root{
  color-scheme:dark;
  --bg:#0b0f14;
  --text:#e6edf3;
  --muted:#9fb0c3;
  --line:rgba(255,255,255,.08);
  --ok:#2fe67a;
  --warn:#ffd24a;
  --bad:#ff5c7a;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(1000px 700px at 20% 0%,rgba(72,61,255,.15),transparent 60%),
    radial-gradient(900px 600px at 90% 10%,rgba(0,212,255,.10),transparent 55%),
    var(--bg);
  color:var(--text);
  padding:24px;
}
.wrap{max-width:1000px;margin:auto}
header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:16px;gap:12px;flex-wrap:wrap
}
h1{margin:0;font-size:22px}
.sub{color:var(--muted);font-size:13px;line-height:1.35}
.btn{
  border:1px solid var(--line);
  background:rgba(255,255,255,.05);
  color:var(--text);
  padding:9px 12px;border-radius:12px;
  cursor:pointer;font-weight:900;font-size:13px
}
.btn:hover{background:rgba(255,255,255,.08)}
.panel{
  border:1px solid var(--line);
  border-radius:16px;
  background:rgba(255,255,255,.02);
  box-shadow:var(--shadow);
  margin-bottom:14px;
  overflow:hidden
}
.panel .hd{
  padding:12px 14px;
  border-bottom:1px solid var(--line);
  font-weight:950;
  display:flex;justify-content:space-between;align-items:center;
  gap:10px;flex-wrap:wrap
}
.panel .bd{padding:14px}
.verdict{font-size:44px;font-weight:1000;letter-spacing:.3px}
.pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:7px 10px;border-radius:999px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  font-weight:950;font-size:12px;margin-top:10px
}
.dot{width:10px;height:10px;border-radius:50%}
.ok{background:var(--ok)}
.warn{background:var(--warn)}
.bad{background:var(--bad)}
.bar{
  height:10px;border-radius:999px;
  background:rgba(255,255,255,.05);
  margin-top:6px;
  overflow:hidden;
  border:1px solid var(--line)
}
.bar>div{height:100%;border-radius:999px;width:0%}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
.k{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(255,255,255,.02)}
.k .h{font-size:12px;color:var(--muted);margin-bottom:6px}
.k .v{font-weight:1000}
.k .v.small{font-weight:850;color:var(--text);opacity:.92;font-size:13px;line-height:1.35}
.k .v.mono{font-family:monospace}
.filters{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
.filter{
  padding:8px 12px;border-radius:999px;
  border:1px solid var(--line);
  cursor:pointer;font-size:12px;font-weight:1000;
  background:rgba(255,255,255,.03)
}
.filter.active{background:rgba(255,255,255,.10)}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{padding:10px 8px;border-bottom:1px solid var(--line);text-align:left}
th{color:var(--muted);font-weight:950;background:rgba(0,0,0,.12)}
.empty{text-align:center;padding:34px 10px;color:var(--muted);font-weight:900}
.inputRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
.input, select{
  border:1px solid var(--line);
  background:rgba(0,0,0,.22);
  color:var(--text);
  padding:10px 12px;border-radius:12px;
  outline:none;font-weight:900
}
.input{flex:1;min-width:180px}
select{min-width:160px}
.smallNote{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.35}
.ctaBanner{
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  border-radius:14px;
  padding:12px 14px;
  margin-bottom:14px;
}
</style>
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
<div class="wrap">
<header>
  <div>
    <h1>Commodity Verdict</h1>
    <div class="sub" id="subtitle">Loading…</div>
  </div>
  <div style="display:flex;gap:10px">
    <button class="btn" id="btnReload">Reload</button>
    <button class="btn" id="btnPdf">Export PDF</button>
  </div>
</header>

<section class="ctaBanner">
Transparent: this dashboard only displays verdicts from your uploaded data — not financial advice.
</section>

<!-- Latest -->
<section class="panel">
<div class="hd">
<div>Latest</div>
<div class="sub">Source: <span id="sourceLabel">—</span></div>
</div>
<div class="bd">
<div id="latestEmpty" class="empty" style="display:none">No data available</div>
<div id="latestBlock" style="display:none">
<div class="verdict" id="latestVerdict">—</div>
<div class="pill">
<span class="dot warn" id="latestDot"></span>
<span id="latestMeta">—</span>
</div>
<div style="margin-top:12px">
<div class="sub">Confidence <b id="latestConf">—%</b></div>
<div class="bar"><div id="confBar"></div></div>
</div>
<div class="grid">
<div class="k"><div class="h">Instrument</div><div class="v" id="latestInst">—</div></div>
<div class="k"><div class="h">Entry zone</div><div class="v small" id="latestEntry">—</div></div>
<div class="k"><div class="h">Invalid if above</div><div class="v" id="latestInvalid">—</div></div>
<div class="k"><div class="h">Risk / Daily cap</div><div class="v" id="latestRisk">—</div></div>
</div>
</div>
</div>
</section>

<!-- Records -->
<section class="panel">
<div class="hd"><div>Records</div></div>
<div class="bd">
<div class="filters">
<div class="filter active" data-key="ALL">All</div>
<div class="filter" data-key="GOLD">Gold</div>
<div class="filter" data-key="SILVER">Silver</div>
<div class="filter" data-key="CRUDE">Crude</div>
<div class="filter" data-key="ZINC">Zinc</div>
<div class="filter" data-key="COPPER">Copper</div>
</div>
<div id="tableWrap" style="overflow:auto;border:1px solid var(--line);border-radius:14px">
<table>
<thead>
<tr>
<th>Date</th>
<th>Record</th>
<th>Instrument</th>
<th>LTP</th>
<th>Verdict</th>
<th>Conf</th>
<th>Entry</th>
<th>Invalid</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>
</div>
<div id="tableEmpty" class="empty" style="display:none">No data available</div>
</div>
</section>
</div>

<script>
const LS_CSV_KEY="VERDICT_CSV";
const LS_CSV_TS="VERDICT_CSV_TS";
const LS_LIVE_JSON="LIVE_VERDICT_JSON";
const CSV_URL="verdict.csv";

const EMBEDDED=`record_id,date,ltp,capital_inr,market,instrument,mode,verdict,confidence_score_percent,entry_zone,invalid_if_above,risk_per_trade_inr,daily_loss_cap_inr
MCXGOLD-20260220-V1,2026-02-20,154700,35000,MCX,Gold Futures (02APR2026),Intraday,SELL,68,"Below 154600 breakdown","155200",350,700
MCXSILVER-20260220-V1,2026-02-20,182450,35000,MCX,Silver Futures (05MAR2026),Intraday,SELL,64,"Below 182000 breakdown","183200",350,700
MCXCRUDE-20260220-V1,2026-02-20,6280,35000,MCX,Crude Oil Futures (19MAR2026),Intraday,BUY,72,"Above 6240 breakout","6180",350,700
MCXZINC-20260220-V1,2026-02-20,267.5,35000,MCX,Zinc Futures (28MAR2026),Intraday,SELL,61,"Below 266 breakdown","270",350,700
MCXCOPPER-20260220-V1,2026-02-20,748.3,35000,MCX,Copper Futures (29MAR2026),Intraday,BUY,66,"Above 744 breakout","738",350,700`;

function parseCSV(text){
const rows=text.trim().split("\n").map(r=>r.split(","));
const header=rows.shift();
return rows.map(r=>{
const o={};
header.forEach((h,i)=>o[h.trim()]=(r[i]||"").replace(/^"|"$/g,"").trim());
return o;
});
}
function safeNum(x){const n=Number(String(x||"").replace(/[^\d.-]/g,""));return Number.isFinite(n)?n:null;}
function verdictDot(v){v=(v||"").toUpperCase();if(v==="BUY")return"ok";if(v==="SELL")return"bad";return"warn";}
function commodityKeyFromInstrument(inst){
const s=String(inst||"").toUpperCase();
if(s.includes("GOLD"))return"GOLD";
if(s.includes("SILVER"))return"SILVER";
if(s.includes("CRUDE"))return"CRUDE";
if(s.includes("ZINC"))return"ZINC";
if(s.includes("COPPER"))return"COPPER";
return"OTHER";
}
function esc(s){return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");}
function pickLatest(records){
return records.sort((a,b)=>Date.parse(b.date)-Date.parse(a.date))[0]||null;
}

let STATE={source:"—",records:[],filter:"ALL"};

function render(){
const filtered=STATE.records.filter(r=>{
if(STATE.filter==="ALL")return true;
return commodityKeyFromInstrument(r.instrument)===STATE.filter;
});
document.getElementById("sourceLabel").textContent=STATE.source;
const latest=pickLatest(filtered);
if(!latest){
document.getElementById("latestBlock").style.display="none";
document.getElementById("latestEmpty").style.display="block";
return;
}
document.getElementById("latestEmpty").style.display="none";
document.getElementById("latestBlock").style.display="block";
document.getElementById("latestVerdict").textContent=latest.verdict;
document.getElementById("latestDot").className="dot "+verdictDot(latest.verdict);
document.getElementById("latestMeta").textContent=latest.record_id;
document.getElementById("latestInst").textContent=latest.instrument;
document.getElementById("latestEntry").textContent=latest.entry_zone;
document.getElementById("latestInvalid").textContent=latest.invalid_if_above;
document.getElementById("latestRisk").textContent=latest.risk_per_trade_inr+" / "+latest.daily_loss_cap_inr;
const conf=safeNum(latest.confidence_score_percent)||0;
document.getElementById("latestConf").textContent=conf+"%";
document.getElementById("confBar").style.width=conf+"%";
const tbody=document.getElementById("rows");
tbody.innerHTML="";
filtered.forEach(r=>{
const tr=document.createElement("tr");
tr.innerHTML=`<td>${esc(r.date)}</td>
<td>${esc(r.record_id)}</td>
<td>${esc(r.instrument)}</td>
<td>${r.ltp||"—"}</td>
<td><span class="dot ${verdictDot(r.verdict)}"></span>${esc(r.verdict)}</td>
<td>${esc(r.confidence_score_percent)}%</td>
<td>${esc(r.entry_zone)}</td>
<td>${esc(r.invalid_if_above)}</td>`;
tbody.appendChild(tr);
});
}

async function loadData(){
const ls=localStorage.getItem(LS_CSV_KEY);
if(ls&&ls.trim().length>10){
STATE.source="localStorage (admin)";
STATE.records=parseCSV(ls);
return;
}
try{
const res=await fetch(CSV_URL,{cache:"no-store"});
if(!res.ok)throw"";
STATE.records=parseCSV(await res.text());
STATE.source=CSV_URL;
}catch{
STATE.records=parseCSV(EMBEDDED);
STATE.source="embedded";
}
}

document.getElementById("btnReload").addEventListener("click",async()=>{
await loadData();render();
});
document.querySelectorAll(".filter").forEach(f=>{
f.addEventListener("click",()=>{
document.querySelectorAll(".filter").forEach(x=>x.classList.remove("active"));
f.classList.add("active");
STATE.filter=f.dataset.key;
render();
});
});

(async()=>{await loadData();render();})();
</script>
</body>
</html>
